```
###############################################################################
#                                                                             #
#   █████   █████           ████                                              #
#  ▒▒███   ▒▒███           ▒▒███                                              #
#   ▒███    ▒███   ██████   ▒███  █████ █████ █████ ████ ████████             #
#   ▒███    ▒███  ▒▒▒▒▒███  ▒███ ▒▒███ ▒▒███ ▒▒███ ▒███ ▒▒███▒▒███            #
#   ▒▒███   ███    ███████  ▒███  ▒███  ▒███  ▒███ ▒███  ▒███ ▒▒▒             #
#    ▒▒▒█████▒    ███▒▒███  ▒███  ▒▒███ ███   ▒███ ▒███  ▒███                 #
#      ▒▒███     ▒▒████████ █████  ▒▒█████    ▒▒████████ █████                #
#       ▒▒▒       ▒▒▒▒▒▒▒▒ ▒▒▒▒▒    ▒▒▒▒▒      ▒▒▒▒▒▒▒▒ ▒▒▒▒▒                 #
#                                                                             #
#   =======================================================================   #
#   |                                                                     |   #
#   |   PROJEKT:     VALVUR - Intsidendi süvaanalüüsi raamistik           |   #
#   |   AUTOR:       Heiki Rebane                                         |   #
#   |   GITHUB:      ocrHeiki  -  (https://github.com/ocrHeiki)           |   #
#   |   STATUS:      02. etapp: Tööjaama süvaanalüüs (TRL-WIN10-01)       |   #
#   |                                                                     |   #
#   =======================================================================   #
#                                                                             #
###############################################################################
```
# 02. etapp: Tööjaama süvaanalüüs (TRL-WIN10-01)

See dokument kirjeldab täielikku töövoogu uuritava masina analüüsimiseks isoleeritud virtuaalkeskkonnas (VM).

## I. Tööriistakast ja skriptid (Võrguühenduseta keskkond)

Selles etapis kasutatavad tööriistad ja skriptid on kohandatud töötamiseks ilma võrguühenduseta.

**Märkus Pythoni kohta:** Skriptide `audit.py` ja `deep_scan.py` käivitamiseks peab süsteemi olema paigaldatud Python 3. Paigaldusjuhised leiate jaotisest "I. Paigaldus ja ettevalmistus" dokumendis `01.etapp.md`.

### 1. `audit.py` (VALVUR skript)
- **Kirjeldus:** Teostab süsteemi esmase triaaži, kogudes kriitilist süsteemiinformatsiooni nagu jooksvad protsessid, võrguühendused (nt `netstat -ano`), DNS vahemälu, süsteemiteenused (`sc query`), startup programmid (`wmic startup`), kasutajakontod (`net user`), administraatorite grupi liikmed (`net localgroup administrators`), käivitatud ajastatud ülesanded ja PowerShell'i ajalugu. Tulemused salvestatakse "audit_results" kausta.
- **Kasutus:** Kopeeri `audit.py` skript isoleeritud masinasse ja käivita käsurealt (administraatori õigustega):
    ```bash
    python audit.py
    ```
- **Käivitamine:** Skript loob kausta `audit_results`, kuhu salvestatakse kõik kogutud andmed tekstifailidena. Pärast käivitamist tuleb kogu `audit_results` kaust analüüsimasinasse edasiseks analüüsiks transportida.

### 2. `deep_scan.py` (VALVUR skript)
- **Kirjeldus:** Teostab failisüsteemi süvaskaneerimise, tuvastades muudatusi, failide loomisaegu ja arvutades SHA256 kontrollsummasid. Skript fokuseerib kriitilistele süsteemiteedele ja potentsiaalselt kahtlastele faililaienditele (nt `.exe`, `.dll`, `.ps1`). Raport salvestatakse `deep_scan_raport.txt` faili.
- **Kasutus:** Kopeeri `deep_scan.py` skript isoleeritud masinasse ja käivita käsurealt (administraatori õigustega):
    ```bash
    python deep_scan.py
    ```
- **Käivitamine:** Skript loob raportifaili (`deep_scan_raport.txt`), mis sisaldab leitud informatsiooni. Raport tuleb pärast käivitamist analüüsimasinasse edasiseks analüüsiks transportida.

### 3. Süsteemiinformatsiooni kogumise skript (nt PowerShell/Bash skript)
- **Kirjeldus:** Kogub kriitilist süsteemiinformatsiooni, nagu protsessid, teenused, autorun kirjed, paigaldatud programmid, võrguühendused (ajaloolised), kasutajakontod ja grupid. See skript on kohandatud käivitamiseks võrguühenduseta masinas ja tulemused salvestatakse lokaalselt. (Märkus: `audit.py` ja `deep_scan.py` pakuvad juba suure osa sellest funktsionaalsusest, kuid see koht on jäetud kohandatud skriptide jaoks, mis võivad koguda spetsiifilisemat infot.)
- **Kasutus:**
    *   **Windows (PowerShell):**
        ```powershell
        # Näide: Skript, mis kogub süsteemiinfot
        Get-Process | Out-File C:\Temp\processes.txt
        Get-Service | Out-File C:\Temp\services.txt
        # Lisada siia kõik vajalikud käsud
        ```
    *   **Linux (Bash):**
        ```bash
        # Näide: Skript, mis kogub süsteemiinfot
        ps aux > /tmp/processes.txt
        systemctl list-units --type=service > /tmp/services.txt
        # Lisada siia kõik vajalikud käsud
        ```
- **Käivitamine:** Kopeeri skript isoleeritud masinasse (nt USB kaudu) ja käivita vastava süsteemi õigustega. Tulemused tuleb hiljem analüüsimasinasse tagasi tuua.

### 4. Mälu dump'i tööriist (nt `DumpIt`, `FTK Imager Lite`)
- **Kirjeldus:** Kogub mälu dump'i (RAM) isoleeritud masinast. Mälu analüüs on kriitilise tähtsusega pahavara tuvastamisel, mis töötab ainult mälus ja ei jäta jälgi kettale.
- **Kasutus:**
    *   **DumpIt (Windows):** Käivita `DumpIt.exe` ja järgi juhiseid mälu dump'i loomiseks.
    *   **FTK Imager Lite (Windows):** Vali "Capture Memory" ja salvesta mälu dump faili.
- **Käivitamine:** Kopeeri tööriist isoleeritud masinasse, käivita see administraatori õigustega. Salvestatud mälu dump tuleb hiljem analüüsimasinasse tagasi tuua edasiseks analüüsiks (nt `Volatility` või `Rekall` abil).

### 5. Disk forensiline koopia (nt `FTK Imager Lite`, `dd` Linuxis)
- **Kirjeldus:** Loo füüsiline või loogiline koopia masina kõvakettast. See tagab, et analüüs viiakse läbi originaalandmeid muutmata.
- **Kasutus:**
    *   **FTK Imager Lite (Windows):** Vali "Create Disk Image" ja järgi juhiseid.
    *   **`dd` (Linux):**
        ```bash
        sudo dd if=/dev/sda of=/mnt/forensic_image.dd bs=4M status=progress
        ```
- **Käivitamine:** Käivita tööriist isoleeritud masinas või ühenda kõvaketas teise forensilise töökoha külge. Koopia tuleb salvestada turvalisele välisele andmekandjale.

## II ETAPP: Süsteemi triaaž ja kasutajate audit (VM-is sees)
1. **Visuaalne vaatlus**: Fikseerida kõik sisselogimisel avanevad aknad, veateated või käsurea konsoolid.
1.1. **Visuaalne dokumentatsioon**: Kõik olulised visuaalsed leiud (nt kahtlased aknad, veateated, käskude väljundid) tuleb jäädvustada ekraanipiltide või fotodena. Need lisatakse hiljem tõendusmaterjalina intsidendi raportisse.
2. **Kasutajate ja õiguste audit**:
   * Käivitada `lusrmgr.msc` (Local Users and Groups) ja kontrollida kontode nimekirja.
   * Kontrollida `Administrators` grupi koosseisu ebatavaliste kasutajate osas.
   * Kontrollida viimati loodud kasutajaid käsurealt: `Get-LocalUser`.
3. **Dünaamiline kontroll**:
   * Kontrollida jooksvate protsesside asukohti ja käsuridu `Task Manager` kaudu.
   * Kontrollida aktiivseid võrguühendusi: `netstat -anob`.

## III ETAPP: Automatiseeritud andmekogumine
Käivitada skriptid andmete koondamiseks:
* `audit.py`: Protsessid, teenused, DNS vahemälu.
* `deep_scan.py`: Failisüsteemi skaneerimine, loomisajad ja SHA256 räsid.

## IV ETAPP: Asitõendite pakkimine
Käivitada PowerShellis koondskript tõendite eksportimiseks:

```powershell
$path = "$env:USERPROFILE\Desktop\Investigation"
New-Item -ItemType Directory -Path $path -Force

# Kasutajate, gruppide ja registri info
Get-LocalUser | Out-File "$path\Local_Users.txt"
Get-LocalGroupMember -Group "Administrators" | Out-File "$path\Admin_Members.txt"
Get-ItemProperty HKCU:\Software\Microsoft\Windows\CurrentVersion\Run | Out-File "$path\Registry_Run.txt"

# Rakendusspetsiifiliste logide kogumine (nt kaughaldustarkvara logid)
# Copy-Item "C:\Path\To\Logs\*" -Destination $path -ErrorAction SilentlyContinue

# Pakkimine
Compress-Archive -Path "$path\*" -DestinationPath "$env:USERPROFILE\Desktop\Asitõendid.zip" -Force
```

## V ETAPP: Väline analüüs
1. Eksportida Asitõendid.zip VM-ist.
2. Kontrollida tuvastatud failide räsisid (SHA256) VirusTotalis.
3. Teostada kahtlaste failide käitumuslik analüüs turvalises liivakastis.
